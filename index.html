<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal SAdmC | 6º BBM</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --azul-dark: #001233;
            --azul-light: #002855;
            --vermelho-cbm: #C40000;
            --laranja-cbm: #FF9E3D;
            --cinza-fundo: #F4F6F9;
            --azul-texto: #002B5B;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }
        body { margin: 0; font-family: 'Open Sans', sans-serif; background: var(--azul-dark); display: flex; flex-direction: column; min-height: 100vh; color: #334155; }

        /* LOGIN */
        #loginScreen { flex: 1; background: radial-gradient(circle, var(--azul-light) 0%, var(--azul-dark) 100%); display: flex; justify-content: center; align-items: center; padding: 20px; }
        .login-container { display: flex; max-width: 850px; width: 100%; min-height: 480px; border-radius: 15px; overflow: hidden; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        .login-left { background: rgba(109, 125, 150, 0.7); backdrop-filter: blur(15px); flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
        .login-right { background: white; flex: 1.2; padding: 45px; display: flex; flex-direction: column; justify-content: center; }
        .login-right h2 { color: var(--azul-texto); font-weight: 800; margin-bottom: 5px; }
        .input-group { margin-top: 15px; }
        .input-group label { font-size: 12px; font-weight: 700; color: #64748b; text-transform: uppercase; }
        .login-right input { width: 100%; padding: 12px; margin-top: 5px; border-radius: 6px; border: 1px solid #ddd; background: #f8fafc; }
        .btn-entrar { width: 100%; padding: 15px; background: var(--vermelho-cbm); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; margin-top: 25px; text-transform: uppercase; letter-spacing: 1px; }

        /* SISTEMA */
        #sistema { display: none; flex: 1; background: var(--cinza-fundo); }
        .header-top { background: var(--azul-texto); color: white; padding: 15px; font-weight: 800; text-align: center; display: flex; align-items: center; justify-content: center; position: relative; }
        .btn-menu { position: absolute; left: 20px; background: none; border: none; color: white; font-size: 22px; cursor: pointer; }
        .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }

        /* BOAS VINDAS */
        .welcome-box { background: linear-gradient(135deg, var(--azul-texto), #004080); color: white; padding: 30px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .welcome-text h2 { margin: 0; font-size: 24px; font-weight: 800; }
        #relogio { font-size: 28px; font-weight: 800; letter-spacing: 1px; }

        /* DASHBOARD MASTER */
        #painelDev { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 40px; border: 1px solid #e2e8f0; }
        .painel-header { background: #f8fafc; padding: 15px 25px; font-weight: 800; border-bottom: 1px solid #eee; color: var(--azul-texto); display: flex; align-items: center; gap: 10px; }
        .form-cad { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; padding: 25px; background: #fbfbfb; }
        .form-cad input, .form-cad select { padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; }
        
        table { width: 100%; border-collapse: collapse; }
        th { background: #f1f5f9; padding: 15px 20px; text-align: left; font-size: 11px; text-transform: uppercase; color: #64748b; letter-spacing: 1px; }
        td { padding: 15px 20px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .badge { padding: 5px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; }
        .badge-secao { background: #e0f2fe; color: #0369a1; }

        /* CARDS DE SEÇÃO */
        .category { margin-bottom: 40px; display: none; }
        .cat-title { border-left: 6px solid var(--vermelho-cbm); padding-left: 15px; font-weight: 800; font-size: 20px; color: var(--azul-texto); margin-bottom: 20px; }
        .grid-links { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .card-link { background: white; padding: 30px; border-radius: 12px; text-align: center; text-decoration: none; color: inherit; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
        .card-link:hover { transform: translateY(-5px); box-shadow: 0 10px 15px rgba(0,0,0,0.05); border-color: var(--laranja-cbm); }
        .card-link i { font-size: 40px; color: var(--azul-texto); margin-bottom: 15px; }

        /* MENU LATERAL */
        #menuLateral { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: var(--azul-dark); z-index: 1000; transition: 0.3s; padding-top: 20px; }
        #menuLateral.ativo { left: 0; }
        .menu-item { padding: 18px 25px; color: white; text-decoration: none; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); cursor: pointer; font-weight: 600; }
        .menu-item:hover { background: var(--azul-light); color: var(--laranja-cbm); }
        #overlay { position: fixed; display: none; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }

        /* FOOTER */
        footer { background: #000E1F; color: white; padding: 40px 20px; border-top: 5px solid var(--vermelho-cbm); text-align: center; }
        .footer-grid { max-width: 1100px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; text-align: left; }
        .footer-info h4 { color: var(--laranja-cbm); margin-bottom: 15px; text-transform: uppercase; font-size: 14px; }
        .footer-info p { font-size: 13px; opacity: 0.8; line-height: 1.6; margin: 5px 0; }
    </style>
</head>
<body>

<div id="overlay" onclick="toggleMenu()"></div>

<div id="menuLateral">
    <div style="text-align: center; padding: 20px;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Brasao_cbmrs.png" width="70">
        <p style="color: white; font-weight: 800; margin-top: 10px; letter-spacing: 1px;">INTRANET 6º BBM</p>
    </div>
    <div id="menuDinamico"></div>
    <a class="menu-item" onclick="solicitarReset()" style="color: var(--laranja-cbm);"><i class="fas fa-key"></i> REDEFINIR SENHA</a>
    <a class="menu-item" onclick="location.reload()" style="color: #ff6b6b; border-top: 1px solid rgba(255,255,255,0.1);"><i class="fas fa-sign-out-alt"></i> SAIR DO PORTAL</a>
</div>

<div id="loginScreen">
    <div class="login-container">
        <div class="login-left">
            <img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Brasao_cbmrs.png" width="160">
            <h1 style="font-size: 60px; font-weight: 800; margin: 10px 0; background: linear-gradient(#FFEB3B, #FF9800); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">CBMRS</h1>
            <p style="font-weight: 600; text-transform: uppercase; letter-spacing: 2px;">6º Batalhão de Bombeiros</p>
        </div>
        <div class="login-right">
            <h2>Acesso SAdmC</h2>
            <p style="color: #64748b; font-size: 13px; margin-bottom: 20px;">AUTENTICAÇÃO DE MILITAR</p>
            
            <div class="input-group">
                <label>E-mail Institucional</label>
                <input type="email" id="email" placeholder="nome.sobrenome@cbm.rs.gov.br">
            </div>
            <div class="input-group">
                <label>Sua Credencial</label>
                <input type="password" id="senha" placeholder="******">
            </div>
            <button class="btn-entrar" onclick="login()">Entrar no Sistema</button>
            <p style="text-align:center; margin-top: 20px; font-size: 12px; color: #94a3b8; cursor: pointer;" onclick="solicitarReset()">Esqueceu a senha? Clique aqui.</p>
        </div>
    </div>
</div>

<div id="sistema">
    <div class="header-top">
        <button class="btn-menu" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        CORPO DE BOMBEIROS MILITAR DO RIO GRANDE DO SUL
    </div>
    
    <div class="container">
        <div class="welcome-box">
            <div class="welcome-text">
                <h2 id="msgBoasVindas">Bem-vindo, Carregando...</h2>
                <p id="dataExtenso" style="margin-top: 5px; opacity: 0.9; font-size: 14px;"></p>
            </div>
            <div id="relogio">00:00:00</div>
        </div>

        <div id="painelDev" style="display: none;">
            <div class="painel-header"><i class="fas fa-user-shield"></i> GESTÃO DE ACESSOS (MASTER)</div>
            <div class="form-cad">
                <input type="text" id="novoNome" placeholder="Nome Completo">
                <input type="email" id="novoEmail" placeholder="E-mail Institucional">
                <select id="novaSecao">
                    <option value="B1">B1 - Pessoal</option>
                    <option value="B2">B2 - Inteligência</option>
                    <option value="B3">B3 - Operações</option>
                    <option value="B4">B4 - Logística</option>
                    <option value="SCor">SCor - Correição</option>
                </select>
                <select id="novoNivel">
                    <option value="user">Usuário Comum</option>
                    <option value="admin">Administrador</option>
                    <option value="MASTER">Master</option>
                </select>
                <button onclick="cadastrarMilitar()" style="background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 800;">CADASTRAR</button>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr><th>Militar</th><th>Seção</th><th>Nível de Acesso</th><th style="text-align:center">Ação</th></tr>
                    </thead>
                    <tbody id="corpoTabela"></tbody>
                </table>
            </div>
        </div>

        <div id="cat-B1" class="category">
            <div class="cat-title">B1 - SEÇÃO DE PESSOAL</div>
            <div class="grid-links">
                <a href="#" class="card-link"><i class="fas fa-calendar-check"></i><br><strong>Escalas de Serviço</strong></a>
                <a href="#" class="card-link"><i class="fas fa-plane-departure"></i><br><strong>Férias e Afastamentos</strong></a>
            </div>
        </div>

        <div id="cat-B2" class="category">
            <div class="cat-title">B2 - AGÊNCIA DE INTELIGÊNCIA</div>
            <div class="grid-links">
                <a href="#" class="card-link"><i class="fas fa-user-secret"></i><br><strong>Relatórios ALI</strong></a>
            </div>
        </div>

        <div id="cat-B3" class="category">
            <div class="cat-title">B3 - OPERAÇÕES</div>
            <div class="grid-links">
                <a href="#" class="card-link"><i class="fas fa-map-marked-alt"></i><br><strong>Planos de Contingência</strong></a>
            </div>
        </div>

        <div id="cat-B4" class="category">
            <div class="cat-title">B4 - LOGÍSTICA</div>
            <div class="grid-links">
                <a href="#" class="card-link"><i class="fas fa-gas-pump"></i><br><strong>Controle de Combustível</strong></a>
                <a href="#" class="card-link"><i class="fas fa-tools"></i><br><strong>Manutenção de VTRs</strong></a>
            </div>
        </div>

        <div id="cat-SCor" class="category">
            <div class="cat-title">SCOR - CORREIÇÃO</div>
            <div class="grid-links">
                <a href="#" class="card-link"><i class="fas fa-gavel"></i><br><strong>Processos Administrativos</strong></a>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-grid">
        <div class="footer-info">
            <h4>Sede 6º BBM</h4>
            <p>Rua Tenente Coronel Brito, 03</p>
            <p>Centro - Santa Cruz do Sul - RS</p>
            <p>CEP: 96810-202</p>
        </div>
        <div class="footer-info">
            <h4>Contato Administrativo</h4>
            <p><i class="fas fa-phone"></i> (51) 3711-2323</p>
            <p><i class="fas fa-envelope"></i> 6bbm-sadm@cbm.rs.gov.br</p>
        </div>
        <div class="footer-info">
            <h4>Acesso Restrito</h4>
            <p>Sistema de uso exclusivo para fins institucionais. Todo acesso é monitorado.</p>
        </div>
    </div>
    <p style="margin-top: 40px; font-size: 11px; opacity: 0.5;">&copy; 2026 CBMRS - Todos os direitos reservados.</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDE0OQwFJ2tDu-Ws2W9ZCalrBQetWoFjwk",
        authDomain: "sadmc-6bbm-4411d.firebaseapp.com",
        databaseURL: "https://sadmc-6bbm-4411d-default-rtdb.firebaseio.com",
        projectId: "sadmc-6bbm-4411d",
        storageBucket: "sadmc-6bbm-4411d.firebasestorage.app",
        messagingSenderId: "566392365968",
        appId: "1:566392365968:web:f18185da477e65ea368915"
    };
    firebase.initializeApp(firebaseConfig);

    function toggleMenu() {
        const m = document.getElementById("menuLateral");
        const o = document.getElementById("overlay");
        m.classList.toggle("ativo");
        o.style.display = m.classList.contains("ativo") ? "block" : "none";
    }

    async function login() {
        const e = document.getElementById("email").value;
        const s = document.getElementById("senha").value;
        try {
            const res = await firebase.auth().signInWithEmailAndPassword(e, s);
            const snap = await firebase.database().ref('militares/' + res.user.uid).get();
            if(snap.exists()) mostrarSistema(snap.val());
        } catch(err) { alert("Falha na autenticação. Verifique seu e-mail e senha."); }
    }

    function mostrarSistema(dados) {
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("sistema").style.display = "block";
        document.getElementById("msgBoasVindas").innerText = "Bem-vindo, " + dados.nome;
        document.getElementById("dataExtenso").innerText = new Date().toLocaleDateString('pt-BR', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
        
        // Mostrar seções baseado no nível ou seção específica
        const secoes = ["B1", "B2", "B3", "B4", "SCor"];
        secoes.forEach(s => {
            if(dados.nivel === "MASTER" || dados.nivel === "admin" || dados.secao === s) {
                document.getElementById("cat-"+s).style.display = "block";
            }
        });

        if(dados.nivel === "MASTER") {
            document.getElementById("painelDev").style.display = "block";
            listarMilitares();
        }
    }

    async function cadastrarMilitar() {
        const nome = document.getElementById("novoNome").value;
        const email = document.getElementById("novoEmail").value;
        const secao = document.getElementById("novaSecao").value;
        const nivel = document.getElementById("novoNivel").value;
        const pass = Math.random().toString(36).slice(-10);

        try {
            const tApp = firebase.initializeApp(firebaseConfig, "Temp");
            const res = await tApp.auth().createUserWithEmailAndPassword(email, pass);
            await firebase.database().ref('militares/' + res.user.uid).set({ nome, secao, nivel });
            await tApp.auth().sendPasswordResetEmail(email);
            alert("Sucesso! Convite enviado para " + email);
            tApp.delete();
            document.getElementById("novoNome").value = "";
            document.getElementById("novoEmail").value = "";
        } catch(e) { alert("Erro ao cadastrar: " + e.message); }
    }

    function listarMilitares() {
        firebase.database().ref('militares').on('value', snap => {
            const tbody = document.getElementById("corpoTabela");
            tbody.innerHTML = "";
            snap.forEach(m => {
                const v = m.val();
                tbody.innerHTML += `<tr>
                    <td><strong>${v.nome}</strong></td>
                    <td><span class="badge badge-secao">${v.secao || 'B1'}</span></td>
                    <td><span class="badge" style="background:#f1f5f9;">${v.nivel}</span></td>
                    <td style="text-align:center"><i class="fas fa-trash-alt" onclick="remover('${m.key}')" style="color:#e11d48; cursor:pointer;"></i></td>
                </tr>`;
            });
        });
    }

    async function remover(uid) {
        if(confirm("Deseja revogar permanentemente este acesso?")) {
            await firebase.database().ref('militares/'+uid).remove();
        }
    }

    async function solicitarReset() {
        const e = document.getElementById("email").value || prompt("Confirme o e-mail institucional:");
        if(e) {
            await firebase.auth().sendPasswordResetEmail(e);
            alert("Link enviado para o e-mail informado.");
        }
    }

    function clock() { document.getElementById("relogio").innerText = new Date().toLocaleTimeString('pt-BR'); }
    setInterval(clock, 1000); clock();
</script>
</body>
</html>
