<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAdmC - 6º BBM | CBMRS</title>

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:'Open Sans',sans-serif;background:#001D3D}
#loginScreen{display:flex;justify-content:center;align-items:center;height:100vh;background:radial-gradient(circle,#003566,#001D3D)}
.login-container{display:flex;max-width:900px;width:100%;background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 40px 80px rgba(0,0,0,.6)}
.login-left{flex:1;background:#4A5568;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px}
.login-left img{width:150px}
.login-left h1{font-size:60px;margin:10px 0}
.login-right{flex:1;padding:50px}
.login-right h2{margin:0 0 20px;color:#003566}
.login-right select,.login-right input{width:100%;padding:14px;margin-bottom:15px;border-radius:8px;border:1px solid #ccc;font-weight:600}
.login-right button{width:100%;padding:16px;background:#C40000;color:#fff;border:none;border-radius:8px;font-weight:800;cursor:pointer}
.login-right button:hover{background:#900}
#erroSenha{display:none;background:#C40000;color:#fff;padding:10px;border-radius:6px;margin-bottom:10px;font-weight:700}
#sistema{display:none;background:#F4F6F9;min-height:100vh;padding-bottom:60px}
.header{background:#003566;color:#fff;padding:15px;text-align:center;font-weight:800}
.dashboard{max-width:1200px;margin:30px auto;padding:0 20px}
.militar-bar{background:#fff;padding:20px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px}
.card{background:#fff;padding:30px;border-radius:10px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,.1)}
.card i{font-size:40px;margin-bottom:15px;color:#003566}
.admin{background:#fff;padding:20px;border-radius:10px;margin-bottom:30px;display:none}
.admin input,.admin select{padding:10px;margin:5px;border-radius:5px;border:1px solid #ccc}
.admin button{padding:10px 15px;background:#27ae60;color:#fff;border:none;border-radius:5px;font-weight:700;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #ddd}
th{background:#003566;color:#fff}
</style>
</head>
<body>

<div id="loginScreen">
  <div class="login-container">
    <div class="login-left">
      <img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Brasao_cbmrs.png">
      <h1>CBMRS</h1>
      <p>6º Batalhão de Bombeiro Militar</p>
    </div>
    <div class="login-right">
      <h2>SAdmC - Acesso</h2>
      <div id="erroSenha">Senha incorreta</div>
      <select id="selectMilitar"></select>
      <input type="password" id="inputSenha" placeholder="Senha">
      <button onclick="acaoLogin()">Entrar</button>
    </div>
  </div>
</div>

<div id="sistema">
  <div class="header">CORPO DE BOMBEIROS MILITAR DO RS</div>

  <div class="dashboard">
    <div class="militar-bar">
      <div>Bem-vindo, <strong id="labelNome"></strong></div>
      <button onclick="logout()" style="background:#C40000;color:white;border:none;padding:8px 15px;border-radius:5px;font-weight:700;cursor:pointer;">Sair</button>
    </div>

    <div class="admin" id="painelAdmin">
      <h3>Painel Administrador</h3>
      <input type="text" id="admNome" placeholder="Nome">
      <input type="password" id="admSenha" placeholder="Senha">
      <select id="admNivel">
        <option value="B1">B1</option>
        <option value="B2">B2</option>
        <option value="B3">B3</option>
        <option value="B4">B4</option>
        <option value="SCOR">SCOR</option>
        <option value="CHEFE">CHEFE</option>
        <option value="MASTER">MASTER</option>
      </select>
      <button onclick="addMilitar()">Cadastrar</button>

      <table>
        <thead>
          <tr><th>Nome</th><th>Nível</th><th>Ação</th></tr>
        </thead>
        <tbody id="tabelaUsuarios"></tbody>
      </table>
    </div>

    <div class="card-grid" id="cardsArea"></div>
  </div>
</div>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDE0OQwFJ2tDu-Ws2W9ZCalrBQetWoFjwk",
  authDomain:"sadmc-6bbm-4411d.firebaseapp.com",
  databaseURL:"https://sadmc-6bbm-4411d-default-rtdb.firebaseio.com",
  projectId:"sadmc-6bbm-4411d",
  storageBucket:"sadmc-6bbm-4411d.appspot.com",
  messagingSenderId:"566392365968",
  appId:"1:566392365968:web:f18185da477e65ea368915"
};

firebase.initializeApp(firebaseConfig);
const database=firebase.database();
let MILITARES={};

database.ref("militares").on("value",snapshot=>{
  MILITARES=snapshot.val()||{"DESENVOLVEDOR":{senha:"admin",nivel:"MASTER"}};
  render();
});

function render(){
  const select=document.getElementById("selectMilitar");
  const tabela=document.getElementById("tabelaUsuarios");
  select.innerHTML="";
  tabela.innerHTML="";
  for(let nome in MILITARES){
    let opt=document.createElement("option");
    opt.value=nome;
    opt.textContent=nome;
    select.appendChild(opt);

    let row=tabela.insertRow();
    row.innerHTML=`<td>${nome}</td>
                   <td>${MILITARES[nome].nivel}</td>
                   <td><button onclick="deletarMilitar('${nome}')">Excluir</button></td>`;
  }
}

function acaoLogin(){
  const nome=document.getElementById("selectMilitar").value;
  const senha=document.getElementById("inputSenha").value;

  if(MILITARES[nome]&&MILITARES[nome].senha===senha){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("sistema").style.display="block";
    document.getElementById("labelNome").innerText=nome;

    const nivel=MILITARES[nome].nivel;
    if(nivel==="MASTER")document.getElementById("painelAdmin").style.display="block";

    gerarCards(nivel);

  }else{
    document.getElementById("erroSenha").style.display="block";
    setTimeout(()=>{document.getElementById("erroSenha").style.display="none";},3000);
  }
}

function gerarCards(nivel){
  const area=document.getElementById("cardsArea");
  area.innerHTML="";
  const secoes={
    B1:"Recursos Humanos",
    B2:"Inteligência",
    B3:"Operações",
    B4:"Logística",
    SCOR:"Correição"
  };
  for(let s in secoes){
    if(nivel==="MASTER"||nivel==="CHEFE"||nivel===s){
      area.innerHTML+=`<div class="card"><i class="fas fa-folder"></i><h3>${secoes[s]}</h3></div>`;
    }
  }
}

function logout(){location.reload();}
function addMilitar(){
  const nome=document.getElementById("admNome").value.toUpperCase();
  const senha=document.getElementById("admSenha").value;
  const nivel=document.getElementById("admNivel").value;
  if(nome&&senha)database.ref("militares/"+nome).set({senha:senha,nivel:nivel});
}
function deletarMilitar(nome){database.ref("militares/"+nome).remove();}
</script>

</body>
</html>
